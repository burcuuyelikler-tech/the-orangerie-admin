<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Orangerie â€” Admin</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Inter:wght@400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --bg:        #F7F5F1;
  --surface:   #FFFFFF;
  --border:    #E4E0D8;
  --border-dk: #C8C2B8;
  --ink:       #1C1814;
  --ink-mid:   #5A5248;
  --ink-lt:    #9A9088;
  --gold:      #A8823C;
  --gold-lt:   #C9A85C;
  --gold-bg:   #FBF7F0;
  --green:     #2D6A4F;
  --green-bg:  #F0F7F4;
  --red:       #C0392B;
  --red-bg:    #FDF2F1;
  --sidebar-w: 240px;
}

html, body { height: 100%; font-size: 15px; }
body {
  font-family: 'Inter', system-ui, sans-serif;
  background: var(--bg);
  color: var(--ink);
  -webkit-font-smoothing: antialiased;
}

/* â”€â”€â”€ LAYOUT â”€â”€â”€ */
.app { display: flex; height: 100vh; overflow: hidden; }

/* SIDEBAR */
.sidebar {
  width: var(--sidebar-w); flex-shrink: 0;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
}

.sidebar-logo {
  padding: 28px 24px 24px;
  border-bottom: 1px solid var(--border);
}
.sidebar-logo-title {
  font-family: 'Cormorant Garamond', serif;
  font-weight: 400; font-size: 20px; letter-spacing: .04em;
  color: var(--ink);
}
.sidebar-logo-sub {
  font-size: 11px; color: var(--ink-lt);
  margin-top: 3px; letter-spacing: .04em;
}

.sidebar-nav { flex: 1; padding: 12px 0; overflow-y: auto; }

.nav-section-label {
  font-size: 10px; font-weight: 500; letter-spacing: .12em;
  text-transform: uppercase; color: var(--ink-lt);
  padding: 16px 20px 6px;
}

.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 20px; margin: 1px 8px;
  font-size: 13.5px; color: var(--ink-mid);
  cursor: pointer; border-radius: 6px;
  transition: all .15s;
}
.nav-item:hover { background: var(--bg); color: var(--ink); }
.nav-item.active { background: var(--gold-bg); color: var(--gold); font-weight: 500; }
.nav-item .nav-icon { font-size: 15px; width: 20px; text-align: center; opacity: .7; }
.nav-item.active .nav-icon { opacity: 1; }

.sidebar-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  font-size: 12px; color: var(--ink-lt);
}

/* MAIN */
.main { flex: 1; display: flex; flex-direction: column; overflow: hidden; background: var(--bg); }

/* TOPBAR */
.topbar {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 0 36px; height: 60px;
  display: flex; align-items: center; justify-content: space-between;
  flex-shrink: 0;
}
.topbar-title { font-size: 16px; font-weight: 500; color: var(--ink); }
.topbar-actions { display: flex; gap: 10px; }

/* SCROLL AREA */
.main-scroll { flex: 1; overflow-y: auto; padding: 32px 36px; }

/* SCREENS */
.screen { display: none; }
.screen.active { display: block; }

/* â”€â”€â”€ COMPONENTS â”€â”€â”€ */

/* BUTTONS */
.btn {
  font-family: 'Inter', sans-serif;
  font-size: 13px; font-weight: 500;
  padding: 9px 18px; border: 1px solid transparent;
  border-radius: 6px; cursor: pointer;
  display: inline-flex; align-items: center; gap: 6px;
  transition: all .15s; white-space: nowrap;
}
.btn-primary { background: var(--ink); color: white; }
.btn-primary:hover { background: #333; }
.btn-gold { background: var(--gold); color: white; border-color: var(--gold); }
.btn-gold:hover { background: var(--gold-lt); }
.btn-success { background: var(--green); color: white; }
.btn-success:hover { background: #236b3f; }
.btn-outline { background: white; color: var(--ink-mid); border-color: var(--border-dk); }
.btn-outline:hover { border-color: var(--ink); color: var(--ink); }
.btn-danger { background: var(--red-bg); color: var(--red); border-color: rgba(192,57,43,.25); }
.btn-danger:hover { background: var(--red); color: white; }
.btn-sm { padding: 6px 13px; font-size: 12px; }
.btn-xs { padding: 4px 10px; font-size: 11px; border-radius: 4px; }

/* STATS */
.stats-row {
  display: grid; grid-template-columns: repeat(4,1fr); gap: 16px; margin-bottom: 28px;
}
.stat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 20px 24px;
}
.stat-card-n {
  font-family: 'Cormorant Garamond', serif;
  font-size: 40px; font-weight: 300; font-style: italic;
  color: var(--ink); line-height: 1;
}
.stat-card-l {
  font-size: 12px; color: var(--ink-lt); margin-top: 5px; letter-spacing: .02em;
}

/* CARD / TABLE */
.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; overflow: hidden; margin-bottom: 20px;
}
.card-header {
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
}
.card-header-title { font-size: 13px; font-weight: 500; color: var(--ink-mid); }

table { width: 100%; border-collapse: collapse; }
thead th {
  padding: 11px 20px;
  font-size: 11px; font-weight: 500; letter-spacing: .06em;
  text-transform: uppercase; color: var(--ink-lt);
  text-align: left; background: var(--bg);
  border-bottom: 1px solid var(--border);
}
tbody tr { border-bottom: 1px solid var(--border); transition: background .1s; }
tbody tr:last-child { border-bottom: none; }
tbody tr:hover { background: var(--bg); }
tbody td { padding: 13px 20px; font-size: 13.5px; color: var(--ink); vertical-align: middle; }
.td-muted { font-size: 12px; color: var(--ink-lt); }

/* BADGES */
.badge {
  display: inline-flex; align-items: center; gap: 5px;
  font-size: 11px; font-weight: 500; padding: 3px 9px;
  border-radius: 20px;
}
.badge::before { content:''; width:6px; height:6px; border-radius:50%; }
.badge-pub { background: var(--green-bg); color: var(--green); }
.badge-pub::before { background: var(--green); }
.badge-draft { background: var(--bg); color: var(--ink-lt); border: 1px solid var(--border); }
.badge-draft::before { background: var(--ink-lt); }

/* â”€â”€â”€ ARTICLE FORM â”€â”€â”€ */
.form-grid { display: grid; grid-template-columns: 1fr 320px; gap: 20px; align-items: start; }

.form-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; overflow: hidden; margin-bottom: 16px;
}
.form-card-title {
  padding: 14px 20px; border-bottom: 1px solid var(--border);
  font-size: 12px; font-weight: 500; letter-spacing: .06em;
  text-transform: uppercase; color: var(--ink-lt);
  background: var(--bg);
}
.form-body { padding: 20px; display: flex; flex-direction: column; gap: 16px; }
.form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

.field { display: flex; flex-direction: column; gap: 5px; }
.field label {
  font-size: 12px; font-weight: 500; color: var(--ink-mid);
  display: flex; align-items: center; gap: 6px;
}
.field label .req { color: var(--red); font-size: 14px; line-height: 1; }
.field input, .field select, .field textarea {
  font-family: 'Inter', sans-serif;
  font-size: 13.5px; color: var(--ink);
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 6px; padding: 9px 13px;
  outline: none; transition: border-color .15s, box-shadow .15s;
  width: 100%;
}
.field input:focus, .field select:focus, .field textarea:focus {
  border-color: var(--gold); box-shadow: 0 0 0 3px rgba(168,130,60,.1);
}
.field textarea { resize: vertical; min-height: 100px; line-height: 1.65; }
.field textarea.body-textarea { min-height: 260px; font-size: 13px; }
.field-hint { font-size: 11.5px; color: var(--ink-lt); line-height: 1.5; }

/* â”€â”€â”€ IMAGE UPLOAD â”€â”€â”€ */
.img-upload-wrap { display: flex; flex-direction: column; gap: 10px; }

.img-spec-box {
  background: var(--gold-bg);
  border: 1px solid rgba(168,130,60,.25);
  border-radius: 6px; padding: 11px 14px;
  display: grid; grid-template-columns: 1fr 1fr; gap: 6px 20px;
}
.img-spec-row {
  display: flex; align-items: center; justify-content: space-between;
  font-size: 12px;
}
.img-spec-label { color: var(--ink-lt); }
.img-spec-val { font-weight: 500; color: var(--ink); font-size: 12px; }
.img-spec-note {
  grid-column: 1/-1; font-size: 11.5px; color: var(--ink-lt);
  margin-top: 4px; border-top: 1px solid rgba(168,130,60,.2); padding-top: 6px;
}

.img-dropzone {
  border: 2px dashed var(--border-dk);
  border-radius: 8px; padding: 28px 20px;
  text-align: center; cursor: pointer;
  transition: all .2s; position: relative;
  background: var(--bg);
}
.img-dropzone:hover { border-color: var(--gold); background: var(--gold-bg); }
.img-dropzone input[type="file"] {
  position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
}
.img-dropzone-icon { font-size: 28px; margin-bottom: 8px; opacity: .5; }
.img-dropzone-label { font-size: 13px; font-weight: 500; color: var(--ink-mid); margin-bottom: 4px; }
.img-dropzone-hint { font-size: 12px; color: var(--ink-lt); }

.img-preview-wrap {
  border-radius: 8px; overflow: hidden;
  border: 1px solid var(--border); display: none; position: relative;
}
.img-preview-wrap.visible { display: block; }
.img-preview-wrap img { width: 100%; height: 180px; object-fit: cover; display: block; }
.img-preview-remove {
  position: absolute; top: 8px; right: 8px;
  background: rgba(255,255,255,.9); border: 1px solid var(--border);
  border-radius: 4px; padding: 4px 8px;
  font-size: 11px; font-weight: 500; cursor: pointer; color: var(--red);
  transition: all .15s;
}
.img-preview-remove:hover { background: var(--red); color: white; border-color: var(--red); }

.img-size-warning {
  display: none; background: var(--red-bg); border: 1px solid rgba(192,57,43,.25);
  border-radius: 6px; padding: 9px 13px;
  font-size: 12px; color: var(--red);
}
.img-size-warning.show { display: block; }

/* â”€â”€â”€ FACTS / TAGS â”€â”€â”€ */
.fact-row {
  display: grid; grid-template-columns: 140px 1fr 32px; gap: 8px; align-items: center;
}
.fact-row input {
  font-family: 'Inter', sans-serif; font-size: 13px; color: var(--ink);
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 6px; padding: 7px 11px; outline: none;
}
.fact-row input:focus { border-color: var(--gold); }
.fact-del-btn {
  width: 32px; height: 32px; border: 1px solid var(--border);
  border-radius: 6px; background: white; cursor: pointer;
  color: var(--ink-lt); font-size: 16px; display: flex;
  align-items: center; justify-content: center; transition: all .15s;
}
.fact-del-btn:hover { border-color: var(--red); color: var(--red); background: var(--red-bg); }

.tags-area { display: flex; flex-wrap: wrap; gap: 6px; min-height: 32px; }
.tag-chip {
  display: inline-flex; align-items: center; gap: 5px;
  font-size: 12px; color: var(--ink-mid);
  background: var(--bg); border: 1px solid var(--border-dk);
  border-radius: 20px; padding: 4px 10px 4px 12px;
}
.tag-chip-del {
  background: none; border: none; cursor: pointer;
  color: var(--ink-lt); font-size: 14px; line-height: 1;
  padding: 0; display: flex; align-items: center;
  transition: color .15s;
}
.tag-chip-del:hover { color: var(--red); }
.tag-add-row { display: flex; gap: 8px; margin-top: 8px; }
.tag-add-row input {
  font-family: 'Inter', sans-serif; font-size: 13px; color: var(--ink);
  background: var(--bg); border: 1px solid var(--border);
  border-radius: 6px; padding: 7px 11px; outline: none; width: 180px;
}
.tag-add-row input:focus { border-color: var(--gold); }

/* â”€â”€â”€ CATEGORIES â”€â”€â”€ */
.cat-cards { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; }
.cat-card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 10px; padding: 20px;
}
.cat-card-name { font-family: 'Cormorant Garamond', serif; font-size: 20px; font-weight: 400; color: var(--ink); margin-bottom: 6px; }
.cat-card-desc { font-size: 13px; color: var(--ink-lt); line-height: 1.6; margin-bottom: 14px; font-style: italic; }

/* â”€â”€â”€ SUBSCRIBERS â”€â”€â”€ */
.sub-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
.sub-stat-big {
  font-family: 'Cormorant Garamond', serif;
  font-size: 52px; font-weight: 300; font-style: italic; color: var(--ink); line-height: 1;
}
.sub-stat-label { font-size: 12px; color: var(--ink-lt); margin-top: 4px; }

/* SEARCH */
.search-row { display: flex; gap: 10px; margin-bottom: 16px; align-items: center; }
.search-input {
  font-family: 'Inter', sans-serif; font-size: 13.5px; color: var(--ink);
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 6px; padding: 9px 14px; outline: none;
  flex: 1; max-width: 300px; transition: border-color .15s;
}
.search-input:focus { border-color: var(--gold); }
.filter-sel {
  font-family: 'Inter', sans-serif; font-size: 13px; color: var(--ink-mid);
  background: var(--surface); border: 1px solid var(--border);
  border-radius: 6px; padding: 9px 12px; outline: none; cursor: pointer;
}

/* EMPTY / LOADING */
.empty { text-align: center; padding: 64px 32px; color: var(--ink-lt); font-size: 14px; font-style: italic; }
.loading-row { text-align: center; padding: 48px; font-size: 13px; color: var(--ink-lt); letter-spacing: .05em; }

/* TOAST */
.toast {
  position: fixed; bottom: 28px; right: 28px; z-index: 9999;
  background: var(--ink); color: white;
  padding: 12px 20px; border-radius: 8px;
  font-size: 13.5px; font-weight: 500;
  box-shadow: 0 4px 20px rgba(0,0,0,.15);
  transform: translateY(60px); opacity: 0;
  transition: all .25s ease; pointer-events: none;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { background: var(--green); }
.toast.error { background: var(--red); }

/* MODAL */
.modal-overlay {
  position: fixed; inset: 0; background: rgba(28,24,20,.45);
  z-index: 500; display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none; transition: opacity .2s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--surface); border-radius: 12px;
  width: 440px; max-width: 90vw; padding: 32px;
  box-shadow: 0 8px 40px rgba(0,0,0,.12);
}
.modal h3 { font-size: 18px; font-weight: 500; color: var(--ink); margin-bottom: 10px; }
.modal p { font-size: 14px; color: var(--ink-mid); line-height: 1.65; margin-bottom: 24px; }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

/* PUBLISH BAR */
.publish-bar {
  position: sticky; bottom: 0; left: 0; right: 0;
  background: var(--surface); border-top: 1px solid var(--border);
  padding: 14px 36px; display: flex; gap: 10px; align-items: center;
  margin: 0 -36px -32px; z-index: 10;
}
.publish-bar-left { flex: 1; font-size: 13px; color: var(--ink-lt); font-style: italic; }
</style>
</head>
<body>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="sidebar-logo-title">The Orangerie</div>
      <div class="sidebar-logo-sub">Admin Panel</div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-section-label">Content</div>
      <div class="nav-item active" onclick="nav(this,'dashboard')">
        <span class="nav-icon">âŠž</span> Dashboard
      </div>
      <div class="nav-item" onclick="nav(this,'articles')">
        <span class="nav-icon">â‰¡</span> All Articles
      </div>
      <div class="nav-item" onclick="nav(this,'new-article'); resetForm()">
        <span class="nav-icon">ï¼‹</span> New Article
      </div>
      <div class="nav-section-label">Settings</div>
      <div class="nav-item" onclick="nav(this,'categories')">
        <span class="nav-icon">â—ˆ</span> Categories
      </div>
      <div class="nav-item" onclick="nav(this,'subscribers')">
        <span class="nav-icon">âœ‰</span> Subscribers
      </div>
      <div class="nav-item" onclick="nav(this,'settings')">
        <span class="nav-icon">âš™</span> Site Settings
      </div>
    </nav>
    <div class="sidebar-footer">The Orangerie Â· mmxxvi</div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <div class="topbar">
      <div class="topbar-title" id="topbar-title">Dashboard</div>
      <div class="topbar-actions" id="topbar-actions"></div>
    </div>

    <div class="main-scroll">

      <!-- â•â• DASHBOARD â•â• -->
      <div id="screen-dashboard" class="screen active">
        <div class="stats-row">
          <div class="stat-card">
            <div class="stat-card-n" id="st-total">â€”</div>
            <div class="stat-card-l">Total Articles</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-n" id="st-pub">â€”</div>
            <div class="stat-card-l">Published</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-n" id="st-draft">â€”</div>
            <div class="stat-card-l">Drafts</div>
          </div>
          <div class="stat-card">
            <div class="stat-card-n" id="st-subs">â€”</div>
            <div class="stat-card-l">Subscribers</div>
          </div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-header-title">Recent Articles</div>
            <button class="btn btn-primary btn-sm" onclick="nav(document.querySelector('.nav-item:nth-child(4)'),'new-article'); resetForm()">+ New Article</button>
          </div>
          <table>
            <thead><tr><th>Title</th><th>Section</th><th>Status</th><th>Date</th><th></th></tr></thead>
            <tbody id="dash-tbody"><tr><td colspan="5" class="loading-row">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>

      <!-- â•â• ARTICLES â•â• -->
      <div id="screen-articles" class="screen">
        <div class="search-row">
          <input class="search-input" type="text" placeholder="Search articles..." id="art-search" oninput="filterArts()">
          <select class="filter-sel" id="art-f-status" onchange="filterArts()">
            <option value="">All Status</option>
            <option value="true">Published</option>
            <option value="false">Drafts</option>
          </select>
          <select class="filter-sel" id="art-f-sec" onchange="filterArts()">
            <option value="">All Sections</option>
          </select>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-header-title">All Articles</div>
            <button class="btn btn-primary btn-sm" onclick="nav(document.querySelector('.nav-item:nth-child(4)'),'new-article'); resetForm()">+ New Article</button>
          </div>
          <table>
            <thead><tr><th>Title</th><th>Section</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead>
            <tbody id="arts-tbody"><tr><td colspan="5" class="loading-row">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>

      <!-- â•â• NEW / EDIT ARTICLE â•â• -->
      <div id="screen-new-article" class="screen">
        <input type="hidden" id="edit-id">

        <div class="form-grid">

          <!-- LEFT COL -->
          <div>
            <!-- Core -->
            <div class="form-card">
              <div class="form-card-title">Article Details</div>
              <div class="form-body">
                <div class="field">
                  <label>Title <span class="req">*</span></label>
                  <input type="text" id="f-title" placeholder="Why Monaco Remains Irreplaceable" oninput="autoSlug()">
                </div>
                <div class="field">
                  <label>Italic part of title</label>
                  <input type="text" id="f-subtitle" placeholder="e.g. Irreplaceable">
                  <div class="field-hint">This part renders in italic in the headline. Leave blank if none.</div>
                </div>
                <div class="form-row-2">
                  <div class="field">
                    <label>Section <span class="req">*</span></label>
                    <select id="f-section"><option value="">Select...</option></select>
                  </div>
                  <div class="field">
                    <label>Slug <span class="req">*</span></label>
                    <input type="text" id="f-slug" placeholder="why-monaco-remains-irreplaceable">
                    <div class="field-hint">Auto-generated. Used in URL.</div>
                  </div>
                </div>
                <div class="field">
                  <label>Deck paragraph</label>
                  <textarea id="f-dek" rows="2" placeholder="A meditation on place, privilege, and permanence..."></textarea>
                </div>
              </div>
            </div>

            <!-- Content -->
            <div class="form-card">
              <div class="form-card-title">Content</div>
              <div class="form-body">
                <div class="field">
                  <label>Opening Lede</label>
                  <textarea id="f-lede" rows="3" placeholder="Opening paragraph â€” sets the atmosphere..."></textarea>
                </div>
                <div class="field">
                  <label>Body Text</label>
                  <textarea id="f-body" class="body-textarea" placeholder="Full article text.

## Section heading (use ## for headings)

Paragraph text here...

Another paragraph..."></textarea>
                  <div class="field-hint">## for section headings Â· Blank line between paragraphs</div>
                </div>
                <div class="field">
                  <label>Pull Quote</label>
                  <textarea id="f-pullquote" rows="2" placeholder="The harbour at dusk. A life lived not loudly, but exquisitely."></textarea>
                  <div class="field-hint">Displayed as a highlighted quote in the article sidebar.</div>
                </div>
              </div>
            </div>

            <!-- Sidebar facts -->
            <div class="form-card">
              <div class="form-card-title">Sidebar â€” Context & Stats</div>
              <div class="form-body">
                <div class="form-row-2">
                  <div class="field">
                    <label>Stat Number</label>
                    <input type="text" id="f-stat-n" placeholder="2 kmÂ²">
                  </div>
                  <div class="field">
                    <label>Stat Label</label>
                    <input type="text" id="f-stat-l" placeholder="The principality's surface area">
                  </div>
                </div>
                <div class="field">
                  <label>Context Facts</label>
                  <div id="facts-list" style="display:flex;flex-direction:column;gap:8px;margin-bottom:8px"></div>
                  <button class="btn btn-outline btn-sm" onclick="addFact()" type="button">+ Add fact row</button>
                </div>
              </div>
            </div>

            <!-- Tags -->
            <div class="form-card">
              <div class="form-card-title">Tags</div>
              <div class="form-body">
                <div class="field">
                  <div class="tags-area" id="tags-area"></div>
                  <div class="tag-add-row">
                    <input type="text" id="tag-input" placeholder="Add a tag..." onkeydown="if(event.key==='Enter'){event.preventDefault();addTag()}">
                    <button class="btn btn-outline btn-sm" onclick="addTag()" type="button">Add</button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- RIGHT COL -->
          <div>

            <!-- Publish -->
            <div class="form-card">
              <div class="form-card-title">Publishing</div>
              <div class="form-body">
                <div class="field">
                  <label>Status</label>
                  <select id="f-published">
                    <option value="false">Draft â€” not visible on site</option>
                    <option value="true">Published â€” live</option>
                  </select>
                </div>
                <div style="display:flex;flex-direction:column;gap:8px">
                  <button class="btn btn-success" onclick="saveArticle(true)" style="width:100%;justify-content:center">Publish Now</button>
                  <button class="btn btn-outline" onclick="saveArticle(false)" style="width:100%;justify-content:center">Save as Draft</button>
                  <button class="btn btn-outline" onclick="nav(document.querySelector('#screen-articles'),'articles')" style="width:100%;justify-content:center;color:var(--ink-lt)">Cancel</button>
                </div>
              </div>
            </div>

            <!-- Cover Image -->
            <div class="form-card">
              <div class="form-card-title">Cover Image</div>
              <div class="form-body">
                <div class="img-upload-wrap">
                  <!-- Spec box -->
                  <div class="img-spec-box">
                    <div class="img-spec-row"><span class="img-spec-label">Recommended size</span><span class="img-spec-val">1200 Ã— 900 px</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Aspect ratio</span><span class="img-spec-val">4:3</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Max file size</span><span class="img-spec-val">2 MB</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Format</span><span class="img-spec-val">JPG, PNG, WEBP</span></div>
                    <div class="img-spec-note">Appears on the homepage card and article header. Larger files slow the site down.</div>
                  </div>
                  <div id="cover-warning" class="img-size-warning" style="display:none"></div>
                  <!-- Dropzone -->
                  <div class="img-dropzone" id="cover-dz">
                    <input type="file" accept="image/jpeg,image/png,image/webp" onchange="handleUpload(this,'cover')">
                    <div class="img-dropzone-icon">ðŸ–¼</div>
                    <div class="img-dropzone-label">Click or drag to upload cover</div>
                    <div class="img-dropzone-hint">JPG Â· PNG Â· WEBP Â· max 2 MB</div>
                  </div>
                  <div class="img-preview-wrap" id="cover-preview-wrap">
                    <img id="cover-preview-img" src="" alt="">
                    <div class="img-preview-remove" onclick="removeImg('cover')">Remove</div>
                  </div>
                  <input type="hidden" id="cover-image-url">
                </div>
              </div>
            </div>

            <!-- Sidebar Image -->
            <div class="form-card">
              <div class="form-card-title">Sidebar Image</div>
              <div class="form-body">
                <div class="img-upload-wrap">
                  <div class="img-spec-box">
                    <div class="img-spec-row"><span class="img-spec-label">Recommended size</span><span class="img-spec-val">600 Ã— 800 px</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Aspect ratio</span><span class="img-spec-val">3:4 (portrait)</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Max file size</span><span class="img-spec-val">1 MB</span></div>
                    <div class="img-spec-row"><span class="img-spec-label">Format</span><span class="img-spec-val">JPG, PNG, WEBP</span></div>
                    <div class="img-spec-note">Appears in the article right sidebar. Portrait format works best.</div>
                  </div>
                  <div id="sidebar-warning" class="img-size-warning" style="display:none"></div>
                  <div class="img-dropzone">
                    <input type="file" accept="image/jpeg,image/png,image/webp" onchange="handleUpload(this,'sidebar')">
                    <div class="img-dropzone-icon">ðŸ–¼</div>
                    <div class="img-dropzone-label">Click or drag to upload sidebar photo</div>
                    <div class="img-dropzone-hint">JPG Â· PNG Â· WEBP Â· max 1 MB</div>
                  </div>
                  <div class="img-preview-wrap" id="sidebar-preview-wrap">
                    <img id="sidebar-preview-img" src="" alt="">
                    <div class="img-preview-remove" onclick="removeImg('sidebar')">Remove</div>
                  </div>
                  <input type="hidden" id="sidebar-image-url">
                </div>
              </div>
            </div>

            <!-- Emoji fallback -->
            <div class="form-card">
              <div class="form-card-title">Emoji Fallback</div>
              <div class="form-body">
                <div class="field">
                  <label>Cover Emoji</label>
                  <input type="text" id="cover-emoji" placeholder="ðŸŒ¿" maxlength="4" style="font-size:24px;text-align:center;letter-spacing:.1em">
                  <div class="field-hint">Used if no photo is uploaded. Pick one that matches the article mood.</div>
                </div>
              </div>
            </div>

          </div><!-- /right col -->
        </div><!-- /form-grid -->
      </div><!-- /new-article -->

      <!-- â•â• CATEGORIES â•â• -->
      <div id="screen-categories" class="screen">
        <div class="form-card" style="margin-bottom:24px">
          <div class="form-card-title">Add New Category</div>
          <div class="form-body">
            <div class="form-row-2">
              <div class="field">
                <label>Name</label>
                <input type="text" id="new-cat-name" placeholder="e.g. Food & Wine">
              </div>
              <div class="field">
                <label>Description</label>
                <input type="text" id="new-cat-desc" placeholder="Short description shown on category pages...">
              </div>
            </div>
            <div><button class="btn btn-primary" onclick="addCategory()">Add Category</button></div>
          </div>
        </div>
        <div class="cat-cards" id="cat-cards">
          <div class="loading-row" style="grid-column:1/-1">Loading...</div>
        </div>
      </div>

      <!-- â•â• SUBSCRIBERS â•â• -->
      <div id="screen-subscribers" class="screen">
        <div class="sub-header">
          <div>
            <div class="sub-stat-big" id="sub-total">â€”</div>
            <div class="sub-stat-label">Total Subscribers</div>
          </div>
          <button class="btn btn-outline" onclick="exportCSV()">Export CSV</button>
        </div>
        <div class="search-row">
          <input class="search-input" type="text" placeholder="Search email..." id="sub-search" oninput="filterSubs()">
          <select class="filter-sel" id="sub-f-status" onchange="filterSubs()">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="unsubscribed">Unsubscribed</option>
          </select>
        </div>
        <div class="card">
          <table>
            <thead><tr><th>Email</th><th>Source</th><th>Status</th><th>Date</th><th></th></tr></thead>
            <tbody id="sub-tbody"><tr><td colspan="5" class="loading-row">Loading...</td></tr></tbody>
          </table>
        </div>
      </div>

      <!-- â•â• SETTINGS â•â• -->
      <div id="screen-settings" class="screen">
        <div class="form-card" style="max-width:640px">
          <div class="form-card-title">Philosophy Quote</div>
          <div class="form-body">
            <div class="field">
              <label>Quote Text</label>
              <textarea id="s-quote-text" rows="3" placeholder="Elegance is not about being noticed..."></textarea>
              <div class="field-hint">Displayed in the large centre section on the homepage. No quotation marks needed â€” they are added automatically.</div>
            </div>
            <div class="field">
              <label>Attribution</label>
              <input type="text" id="s-quote-author" placeholder="Giorgio Armani">
              <div class="field-hint">Shown below the quote as "â€” Name"</div>
            </div>
            <div>
              <button class="btn btn-success" onclick="saveSettings()">Save Changes</button>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /main-scroll -->
  </main>
</div>

<!-- DELETE MODAL -->
<div class="modal-overlay" id="del-modal">
  <div class="modal">
    <h3>Delete Article</h3>
    <p>This cannot be undone. The article will be permanently removed.</p>
    <div class="modal-actions">
      <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
      <button class="btn btn-danger" onclick="confirmDelete()">Delete permanently</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// â”€â”€ CONFIG â”€â”€
const SB_URL = 'https://ucwgkduvpnklfggleupb.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVjd2drZHV2cG5rbGZnZ2xldXBiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDE1NzcsImV4cCI6MjA4NzE3NzU3N30.AKBjKoYp2xie6qd19crJVMIJDFzmXPTqU2BTtFHnypw';
const BUCKET = 'orangerie-images';
const HDR    = { 'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`, 'Content-Type': 'application/json', 'Prefer': 'return=representation' };

// â”€â”€ STATE â”€â”€
let allArticles = [], allCats = [], allSubs = [];
let curTags = [], curFacts = [];
let delId = null, editingId = null;

// IMAGE LIMITS (bytes)
const IMG_LIMITS = { cover: 2 * 1024 * 1024, sidebar: 1 * 1024 * 1024 };

// â”€â”€ SUPABASE â”€â”€
async function sb(path, opts={}) {
  const res = await fetch(`${SB_URL}/rest/v1/${path}`, { headers: HDR, ...opts });
  if (!res.ok) throw new Error(await res.text());
  return res.json().catch(() => null);
}

async function uploadImg(file, name) {
  const ext  = file.name.split('.').pop();
  const path = `articles/${Date.now()}-${name}.${ext}`;
  const res  = await fetch(`${SB_URL}/storage/v1/object/${BUCKET}/${path}`, {
    method: 'POST',
    headers: { 'apikey': SB_KEY, 'Authorization': `Bearer ${SB_KEY}`, 'Content-Type': file.type },
    body: file
  });
  if (!res.ok) throw new Error('Upload failed');
  return `${SB_URL}/storage/v1/object/public/${BUCKET}/${path}`;
}

// â”€â”€ NAV â”€â”€
function nav(el, screen) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  if (el && el.classList) el.classList.add('active');
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(`screen-${screen}`).classList.add('active');
  const titles = { dashboard:'Dashboard', articles:'All Articles', 'new-article': editingId ? 'Edit Article' : 'New Article', categories:'Categories', subscribers:'Subscribers', settings:'Site Settings' };
  document.getElementById('topbar-title').textContent = titles[screen] || screen;
  if (screen === 'dashboard')   loadDash();
  if (screen === 'articles')    loadArts();
  if (screen === 'categories')  loadCats();
  if (screen === 'subscribers') loadSubs();
  if (screen === 'settings')    loadSettings();
}

// â”€â”€ DASHBOARD â”€â”€
async function loadDash() {
  try {
    const [arts, subs] = await Promise.all([
      sb('orangerie_articles?select=id,title,section,published,created_at&order=created_at.desc'),
      sb('orangerie_subscribers?select=id')
    ]);
    allArticles = arts;
    document.getElementById('st-total').textContent = arts.length;
    document.getElementById('st-pub').textContent   = arts.filter(a=>a.published).length;
    document.getElementById('st-draft').textContent = arts.filter(a=>!a.published).length;
    document.getElementById('st-subs').textContent  = subs.length;

    const tbody = document.getElementById('dash-tbody');
    if (!arts.length) { tbody.innerHTML = '<tr><td colspan="5" class="empty">No articles yet.</td></tr>'; return; }
    tbody.innerHTML = arts.slice(0,8).map(a => `
      <tr>
        <td><strong>${a.title}</strong></td>
        <td class="td-muted">${a.section}</td>
        <td><span class="badge ${a.published?'badge-pub':'badge-draft'}">${a.published?'Published':'Draft'}</span></td>
        <td class="td-muted">${fmtDate(a.created_at)}</td>
        <td><button class="btn btn-outline btn-xs" onclick="editArt('${a.id}')">Edit</button></td>
      </tr>`).join('');
  } catch(e) { toast('Dashboard error: '+e.message,'error'); }
}

// â”€â”€ ARTICLES â”€â”€
async function loadArts() {
  try {
    allArticles = await sb('orangerie_articles?select=*&order=created_at.desc');
    renderArts(allArticles);
    populateSectionFilter();
  } catch(e) {
    document.getElementById('arts-tbody').innerHTML = `<tr><td colspan="5" style="padding:20px;color:var(--red)">${e.message}</td></tr>`;
  }
}

function renderArts(list) {
  const tbody = document.getElementById('arts-tbody');
  if (!list.length) { tbody.innerHTML = '<tr><td colspan="5" class="empty">No articles found.</td></tr>'; return; }
  tbody.innerHTML = list.map(a => `
    <tr>
      <td><strong>${a.title}</strong></td>
      <td class="td-muted">${a.section}</td>
      <td><span class="badge ${a.published?'badge-pub':'badge-draft'}">${a.published?'Published':'Draft'}</span></td>
      <td class="td-muted">${fmtDate(a.created_at)}</td>
      <td style="display:flex;gap:6px">
        <button class="btn btn-outline btn-xs" onclick="editArt('${a.id}')">Edit</button>
        <button class="btn btn-danger btn-xs" onclick="openDel('${a.id}')">Delete</button>
      </td>
    </tr>`).join('');
}

function filterArts() {
  const q  = document.getElementById('art-search').value.toLowerCase();
  const st = document.getElementById('art-f-status').value;
  const sc = document.getElementById('art-f-sec').value;
  renderArts(allArticles.filter(a =>
    (!q  || a.title.toLowerCase().includes(q)) &&
    (!st || String(a.published) === st) &&
    (!sc || a.section === sc)
  ));
}

function populateSectionFilter() {
  const secs = [...new Set(allArticles.map(a=>a.section))];
  document.getElementById('art-f-sec').innerHTML =
    '<option value="">All Sections</option>' + secs.map(s=>`<option value="${s}">${s}</option>`).join('');
}

// â”€â”€ EDIT ARTICLE â”€â”€
async function editArt(id) {
  editingId = id;
  nav(null,'new-article');
  document.getElementById('topbar-title').textContent = 'Edit Article';
  try {
    const [a] = await sb(`orangerie_articles?id=eq.${id}&select=*`);
    if (!a) return;
    document.getElementById('edit-id').value      = a.id;
    document.getElementById('f-title').value      = a.title||'';
    document.getElementById('f-subtitle').value   = a.subtitle||'';
    document.getElementById('f-slug').value       = a.slug||'';
    document.getElementById('f-dek').value        = a.subtitle||'';
    document.getElementById('f-lede').value       = a.lede||'';
    document.getElementById('f-body').value       = a.body||'';
    document.getElementById('f-pullquote').value  = a.pull_quote||'';
    document.getElementById('f-stat-n').value     = a.stat_number||'';
    document.getElementById('f-stat-l').value     = a.stat_label||'';
    document.getElementById('cover-emoji').value  = a.cover_emoji||'ðŸ“°';
    document.getElementById('f-published').value  = String(a.published);
    document.getElementById('cover-image-url').value   = a.cover_image_url||'';
    document.getElementById('sidebar-image-url').value = a.sidebar_image_url||'';
    if (a.cover_image_url) {
      document.getElementById('cover-preview-img').src = a.cover_image_url;
      document.getElementById('cover-preview-wrap').classList.add('visible');
    }
    if (a.sidebar_image_url) {
      document.getElementById('sidebar-preview-img').src = a.sidebar_image_url;
      document.getElementById('sidebar-preview-wrap').classList.add('visible');
    }
    await populateSecSelect(a.section);
    curTags  = a.tags||[];
    curFacts = a.facts||[];
    renderTags(); renderFacts();
  } catch(e) { toast('Error loading article: '+e.message,'error'); }
}

// â”€â”€ SAVE ARTICLE â”€â”€
async function saveArticle(publish) {
  const title = document.getElementById('f-title').value.trim();
  const slug  = document.getElementById('f-slug').value.trim();
  const sec   = document.getElementById('f-section').value;
  if (!title || !slug || !sec) { toast('Title, slug and section required.','error'); return; }

  const payload = {
    title, section: sec, slug,
    subtitle:          document.getElementById('f-subtitle').value.trim()||null,
    lede:              document.getElementById('f-lede').value.trim()||null,
    body:              document.getElementById('f-body').value.trim()||null,
    pull_quote:        document.getElementById('f-pullquote').value.trim()||null,
    cover_emoji:       document.getElementById('cover-emoji').value.trim()||'ðŸ“°',
    cover_image_url:   document.getElementById('cover-image-url').value||null,
    sidebar_image_url: document.getElementById('sidebar-image-url').value||null,
    stat_number:       document.getElementById('f-stat-n').value.trim()||null,
    stat_label:        document.getElementById('f-stat-l').value.trim()||null,
    facts:  curFacts,
    tags:   curTags,
    published: publish !== undefined ? publish : document.getElementById('f-published').value === 'true'
  };

  try {
    const id = document.getElementById('edit-id').value;
    if (id) {
      await sb(`orangerie_articles?id=eq.${id}`, { method:'PATCH', body:JSON.stringify(payload) });
      toast('Article updated.','success');
    } else {
      await sb('orangerie_articles', { method:'POST', body:JSON.stringify(payload) });
      toast(publish ? 'Published!' : 'Draft saved.', 'success');
      resetForm();
    }
    setTimeout(() => nav(document.querySelectorAll('.nav-item')[1],'articles'), 900);
  } catch(e) { toast('Save failed: '+e.message,'error'); }
}

// â”€â”€ RESET FORM â”€â”€
function resetForm() {
  editingId = null;
  ['edit-id','f-title','f-subtitle','f-slug','f-dek','f-lede','f-body','f-pullquote','f-stat-n','f-stat-l'].forEach(id => {
    const el = document.getElementById(id); if (el) el.value='';
  });
  document.getElementById('cover-emoji').value   = 'ðŸ“°';
  document.getElementById('f-published').value   = 'false';
  document.getElementById('cover-image-url').value   = '';
  document.getElementById('sidebar-image-url').value = '';
  document.getElementById('cover-preview-wrap').classList.remove('visible');
  document.getElementById('sidebar-preview-wrap').classList.remove('visible');
  curTags=[]; curFacts=[];
  renderTags(); renderFacts();
  populateSecSelect();
}

// â”€â”€ IMAGE UPLOAD â”€â”€
async function handleUpload(input, type) {
  const file = input.files[0]; if (!file) return;
  toast('Uploading...','');
  try {
    const url = await uploadImg(file, type);
    document.getElementById(`${type}-image-url`).value = url;
    document.getElementById(`${type}-preview-img`).src = url;
    document.getElementById(`${type}-preview-wrap`).classList.add('visible');
    toast('Image uploaded.','success');
  } catch(e) { toast('Upload failed: '+e.message,'error'); }
}

function removeImg(type) {
  document.getElementById(`${type}-image-url`).value = '';
  document.getElementById(`${type}-preview-img`).src = '';
  document.getElementById(`${type}-preview-wrap`).classList.remove('visible');
}

// â”€â”€ SLUG â”€â”€
function autoSlug() {
  if (document.getElementById('edit-id').value) return;
  const t = document.getElementById('f-title').value;
  document.getElementById('f-slug').value = t.toLowerCase()
    .replace(/[^a-z0-9\s-]/g,'').trim().replace(/\s+/g,'-').substring(0,80);
}

// â”€â”€ SECTION SELECT â”€â”€
async function populateSecSelect(selected='') {
  if (!allCats.length) allCats = await sb('orangerie_categories?select=*&order=name').catch(()=>[]);
  document.getElementById('f-section').innerHTML =
    '<option value="">Select section...</option>' +
    allCats.map(c => `<option value="${c.name}" ${c.name===selected?'selected':''}>${c.name}</option>`).join('');
}

// â”€â”€ TAGS â”€â”€
function renderTags() {
  document.getElementById('tags-area').innerHTML = curTags.map((t,i) => `
    <span class="tag-chip">${t}
      <button class="tag-chip-del" onclick="curTags.splice(${i},1);renderTags()" type="button">Ã—</button>
    </span>`).join('');
}
function addTag() {
  const inp = document.getElementById('tag-input');
  const v   = inp.value.trim();
  if (v && !curTags.includes(v)) { curTags.push(v); renderTags(); }
  inp.value = '';
}

// â”€â”€ FACTS â”€â”€
function renderFacts() {
  document.getElementById('facts-list').innerHTML = curFacts.map((f,i) => `
    <div class="fact-row">
      <input type="text" value="${f.label||''}" placeholder="Label" oninput="curFacts[${i}].label=this.value">
      <input type="text" value="${f.value||''}" placeholder="Value" oninput="curFacts[${i}].value=this.value">
      <button class="fact-del-btn" onclick="curFacts.splice(${i},1);renderFacts()" type="button">Ã—</button>
    </div>`).join('');
}
function addFact() { curFacts.push({label:'',value:''}); renderFacts(); }

// â”€â”€ CATEGORIES â”€â”€
async function loadCats() {
  try {
    allCats = await sb('orangerie_categories?select=*&order=name');
    const grid = document.getElementById('cat-cards');
    if (!allCats.length) { grid.innerHTML='<div class="empty" style="grid-column:1/-1">No categories yet.</div>'; return; }
    grid.innerHTML = allCats.map(c => `
      <div class="cat-card">
        <div class="cat-card-name">${c.name}</div>
        <div class="cat-card-desc">${c.description||'â€”'}</div>
        <button class="btn btn-danger btn-sm" onclick="deleteCat('${c.id}','${c.name}')">Delete</button>
      </div>`).join('');
  } catch(e) { toast('Error: '+e.message,'error'); }
}

async function addCategory() {
  const name = document.getElementById('new-cat-name').value.trim();
  const desc = document.getElementById('new-cat-desc').value.trim();
  if (!name) { toast('Category name required.','error'); return; }
  try {
    await sb('orangerie_categories', { method:'POST', body:JSON.stringify({name,description:desc||null}) });
    document.getElementById('new-cat-name').value = '';
    document.getElementById('new-cat-desc').value = '';
    toast('Category added.','success');
    loadCats();
  } catch(e) { toast('Error: '+e.message,'error'); }
}

async function deleteCat(id, name) {
  if (!confirm(`Delete "${name}"?`)) return;
  try {
    await sb(`orangerie_categories?id=eq.${id}`, { method:'DELETE' });
    toast('Deleted.','success'); loadCats();
  } catch(e) { toast('Error: '+e.message,'error'); }
}

// â”€â”€ SUBSCRIBERS â”€â”€
async function loadSubs() {
  try {
    allSubs = await sb('orangerie_subscribers?select=*&order=created_at.desc');
    document.getElementById('sub-total').textContent = allSubs.length;
    renderSubs(allSubs);
  } catch(e) { toast('Error: '+e.message,'error'); }
}

function renderSubs(list) {
  const tbody = document.getElementById('sub-tbody');
  if (!list.length) { tbody.innerHTML='<tr><td colspan="5" class="empty">No subscribers yet.</td></tr>'; return; }
  tbody.innerHTML = list.map(s => `
    <tr>
      <td>${s.email}</td>
      <td class="td-muted">${s.source||'website'}</td>
      <td><span class="badge ${s.status==='active'?'badge-pub':'badge-draft'}">${s.status}</span></td>
      <td class="td-muted">${fmtDate(s.created_at)}</td>
      <td>${s.status==='active'?`<button class="btn btn-outline btn-xs" onclick="unsubscribe('${s.id}')">Unsubscribe</button>`:''}</td>
    </tr>`).join('');
}

function filterSubs() {
  const q  = document.getElementById('sub-search').value.toLowerCase();
  const st = document.getElementById('sub-f-status').value;
  renderSubs(allSubs.filter(s => (!q||s.email.toLowerCase().includes(q)) && (!st||s.status===st)));
}

async function unsubscribe(id) {
  try {
    await sb(`orangerie_subscribers?id=eq.${id}`, { method:'PATCH', body:JSON.stringify({status:'unsubscribed'}) });
    toast('Updated.','success'); loadSubs();
  } catch(e) { toast('Error: '+e.message,'error'); }
}

function exportCSV() {
  if (!allSubs.length) { toast('No subscribers to export.','error'); return; }
  const csv = [['Email','Status','Source','Date'], ...allSubs.map(s=>[s.email,s.status,s.source,fmtDate(s.created_at)])].map(r=>r.join(',')).join('\n');
  const a   = Object.assign(document.createElement('a'),{href:URL.createObjectURL(new Blob([csv],{type:'text/csv'})),download:'orangerie-subscribers.csv'});
  a.click(); toast('CSV exported.','success');
}

// â”€â”€ SETTINGS â”€â”€
async function loadSettings() {
  try {
    const rows = await sb('orangerie_settings?select=*');
    const map  = Object.fromEntries(rows.map(r => [r.key, r.value]));
    document.getElementById('s-quote-text').value   = map['quote_text']   || '';
    document.getElementById('s-quote-author').value = map['quote_author'] || '';
  } catch(e) { toast('Error loading settings: '+e.message,'error'); }
}

async function saveSettings() {
  const text   = document.getElementById('s-quote-text').value.trim();
  const author = document.getElementById('s-quote-author').value.trim();
  if (!text) { toast('Quote text cannot be empty.','error'); return; }
  try {
    await Promise.all([
      sb('orangerie_settings?key=eq.quote_text',   { method:'PATCH', body:JSON.stringify({value:text})   }),
      sb('orangerie_settings?key=eq.quote_author', { method:'PATCH', body:JSON.stringify({value:author}) })
    ]);
    toast('Settings saved.','success');
  } catch(e) { toast('Save failed: '+e.message,'error'); }
}
function openDel(id) { delId=id; document.getElementById('del-modal').classList.add('open'); }
function closeModal() { document.getElementById('del-modal').classList.remove('open'); delId=null; }
async function confirmDelete() {
  if (!delId) return;
  try {
    await sb(`orangerie_articles?id=eq.${delId}`, { method:'DELETE' });
    toast('Article deleted.','success');
    closeModal();
    loadArts();
  } catch(e) { toast('Error: '+e.message,'error'); }
}

// â”€â”€ TOAST â”€â”€
function toast(msg, type='') {
  const t = document.getElementById('toast');
  t.textContent=msg; t.className=`toast${type?' '+type:''} show`;
  setTimeout(()=>t.classList.remove('show'),3000);
}

// â”€â”€ UTILS â”€â”€
function fmtDate(d) { return new Date(d).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}); }

// â”€â”€ INIT â”€â”€
(async()=>{ await populateSecSelect(); loadDash(); })();
</script>
</body>
</html>
